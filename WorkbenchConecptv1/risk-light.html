<!DOCTYPE html>
<html lang="en">
<head>
  <title>Underwriting Workbench — Risk (Light)</title>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">
  <script src="https://unpkg.com/lucide@0.456.0/dist/umd/lucide.js"></script>
  <style>
    :root{
      --brand:#6F1111; --brand-2:#7A1414;
      --ink:#0F1216; --text:#2A2F33; --muted:#6B757E;
      --bg:#F6F7F9; --surface:#fff; --border:#E6E9EE;
      --shadow:0 10px 30px rgba(17,20,24,.06),0 2px 8px rgba(17,20,24,.04);
      --green:#2E7D32; --amber:#FB8C00; --blue:#1976D2; --purple:#7C3AED; --grey:#667085; --danger:#B51212;
    }
    *{box-sizing:border-box} body{margin:0;background:var(--bg);color:var(--text);font-family:Inter,system-ui}
    a{color:inherit;text-decoration:none}

    /* App bar */
    .appbar{position:sticky;top:0;z-index:1000;display:grid;grid-template-columns:280px 1fr auto;gap:16px;align-items:center;padding:14px 20px;background:linear-gradient(180deg,var(--brand),var(--brand-2));color:#fff;box-shadow:var(--shadow)}
    .brand{display:flex;gap:12px;align-items:center}
    .logo{width:36px;height:36px;border-radius:12px;background:linear-gradient(135deg,#fff,rgba(255,255,255,.9));display:grid;place-items:center}
    .logo svg{width:22px;height:22px;fill:var(--brand)}
    .title{font-weight:800}
    .appnav{display:flex;gap:8px}
    .navbtn{border:none;background:rgba(255,255,255,.14);color:#fff;padding:8px 12px;border-radius:10px;font-weight:700;cursor:pointer}
    .navbtn.primary{background:#fff;color:var(--brand)}

    /* Main layout - single column, data dense */
    .wrap{max-width:1400px;margin:0 auto;padding:20px;display:grid;gap:16px}
    
    /* Compact cards */
    .card{background:var(--surface);border:1px solid var(--border);border-radius:12px;box-shadow:var(--shadow);margin-bottom:16px}
    .card-header{padding:12px 16px;border-bottom:1px solid var(--border);display:flex;justify-content:space-between;align-items:center;background:#f8f9fa}
    .card-body{padding:16px}
    .card-title{font-weight:700;font-size:14px;color:var(--brand);margin:0}
    
    /* Data grid - ultra compact */
    .data-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:12px}
    .data-item{display:flex;justify-content:space-between;align-items:center;padding:6px 0;border-bottom:1px solid #f0f0f0;font-size:12px}
    .data-item:last-child{border-bottom:none}
    .data-label{font-weight:600;color:var(--muted);min-width:80px}
    .data-value{color:var(--text);font-weight:500;text-align:right}
    
    /* Inline editing */
    .editable{cursor:pointer;padding:2px 4px;border-radius:4px;transition:background 0.2s}
    .editable:hover{background:#f0f0f0}
    .editing{background:#fff;border:1px solid var(--brand);padding:2px 4px;border-radius:4px}
    
    /* Compact tables */
    .compact-table{width:100%;border-collapse:collapse;font-size:11px}
    .compact-table th{background:#f8f9fa;padding:6px 8px;text-align:left;font-weight:600;color:var(--muted);border-bottom:1px solid var(--border)}
    .compact-table td{padding:6px 8px;border-bottom:1px solid #f0f0f0}
    .compact-table tr:hover{background:#f8f9fa}
    
    /* Status badges */
    .badge{display:inline-flex;align-items:center;gap:4px;padding:3px 8px;border-radius:12px;font-size:10px;font-weight:600;text-transform:uppercase;letter-spacing:0.5px}
    .badge.primary{background:var(--brand);color:#fff}
    .badge.success{background:var(--green);color:#fff}
    .badge.warning{background:var(--amber);color:#fff}
    .badge.info{background:var(--blue);color:#fff}
    
    /* Action buttons */
    .btn{display:inline-flex;align-items:center;gap:4px;padding:6px 10px;border:1px solid var(--border);border-radius:6px;background:#fff;cursor:pointer;font-size:11px;font-weight:600;transition:all 0.2s}
    .btn:hover{background:#f8f9fa;transform:translateY(-1px)}
    .btn.primary{background:var(--brand);color:#fff;border-color:var(--brand)}
    .btn.small{padding:4px 8px;font-size:10px}
    
    /* Referral system */
    .referral-item{background:#fff3cd;border:1px solid #f59e0b;border-radius:6px;padding:8px;margin-bottom:6px;font-size:11px}
    .referral-status{display:inline-block;padding:2px 6px;border-radius:4px;font-size:9px;font-weight:600;margin-right:6px}
    .referral-status.pending{background:#fef3c7;color:#92400e}
    .referral-status.approved{background:#d1fae5;color:#065f46}
    
    /* SOV table */
    .sov-table{width:100%;font-size:11px}
    .sov-table th{background:#f8f9fa;padding:4px 6px;font-weight:600;color:var(--muted)}
    .sov-table td{padding:4px 6px;border-bottom:1px solid #f0f0f0}
    
    /* Loss run table */
    .loss-table{width:100%;font-size:11px}
    .loss-table th{background:#f8f9fa;padding:4px 6px;font-weight:600;color:var(--muted)}
    .loss-table td{padding:4px 6px;border-bottom:1px solid #f0f0f0}
    
    /* Hidden by default */
    .hidden{display:none!important}
    
    /* Responsive */
    @media(max-width:1200px){
      .data-grid{grid-template-columns:repeat(auto-fit,minmax(150px,1fr))}
    }
  </style>
</head>
<body>
<header class="appbar">
  <div class="brand">
    <div class="logo">
      <svg viewBox="0 0 24 24">
        <path d="M12 2l7 3v6c0 5-3.5 8.4-7 9.9C8.5 19.4 5 16 5 11V5l7-3zM12 7a2.75 2.75 0 110 5.5A2.75 2.75 0 0112 7zm0 6.5c-2.8 0-5 1.6-5 3.5v1.2c1.7 1.1 3.5 2 5 2.6 1.5-.6 3.3-1.5 5-2.6V17c0-1.9-2.2-3.5-5-3.5z"/>
      </svg>
    </div>
    <div>
      <div style="font-size:12px;opacity:.9;letter-spacing:.18em;text-transform:uppercase">Underwriting Workbench</div>
      <div class="title">Risk Details</div>
    </div>
  </div>
  <div class="appnav">
    <button class="navbtn" onclick="location.href='index.html'">← Back</button>
    <button class="navbtn primary" onclick="saveAllChanges()">Save Changes</button>
  </div>
</header>

<main class="wrap">
  <!-- Risk Header -->
  <div class="card">
    <div class="card-header">
      <h1 id="riskName" style="margin:0;font-size:20px;font-weight:800">Loading...</h1>
      <div style="display:flex;gap:8px;align-items:center">
        <span id="riskStage" class="badge primary">Stage</span>
        <span id="riskPriority" class="badge warning">Priority</span>
      </div>
    </div>
    <div class="card-body">
      <div class="data-grid">
        <div class="data-item">
          <span class="data-label">Insured:</span>
          <span class="data-value editable" data-field="insured" id="insured">—</span>
        </div>
        <div class="data-item">
          <span class="data-label">Broker:</span>
          <span class="data-value editable" data-field="broker" id="broker">—</span>
        </div>
        <div class="data-item">
          <span class="data-label">LOB:</span>
          <span class="data-value editable" data-field="lob" id="lob">—</span>
        </div>
        <div class="data-item">
          <span class="data-label">Product:</span>
          <span class="data-value editable" data-field="product" id="product">—</span>
        </div>
        <div class="data-item">
          <span class="data-label">Premium:</span>
          <span class="data-value editable" data-field="premium" id="premium">—</span>
        </div>
        <div class="data-item">
          <span class="data-label">Effective:</span>
          <span class="data-value editable" data-field="eff" id="eff">—</span>
        </div>
        <div class="data-item">
          <span class="data-label">Expiry:</span>
          <span class="data-value editable" data-field="exp" id="exp">—</span>
        </div>
        <div class="data-item">
          <span class="data-label">Channel:</span>
          <span class="data-value editable" data-field="channel" id="channel">—</span>
        </div>
      </div>
    </div>
  </div>

  <!-- Two Column Layout -->
  <div style="display:grid;grid-template-columns:1fr 1fr;gap:16px">
    
    <!-- Left Column -->
    <div>
      <!-- Policy Details -->
      <div class="card">
        <div class="card-header">
          <h3 class="card-title">Policy Details</h3>
        </div>
        <div class="card-body">
          <div class="data-grid">
            <div class="data-item">
              <span class="data-label">Limits:</span>
              <span class="data-value editable" data-field="limits" id="limits">—</span>
            </div>
            <div class="data-item">
              <span class="data-label">Deductible:</span>
              <span class="data-value editable" data-field="deductible" id="deductible">—</span>
            </div>
            <div class="data-item">
              <span class="data-label">Retention:</span>
              <span class="data-value editable" data-field="retention" id="retention">—</span>
            </div>
            <div class="data-item">
              <span class="data-label">Exposure:</span>
              <span class="data-value editable" data-field="exposure" id="exposure">—</span>
            </div>
            <div class="data-item">
              <span class="data-label">Rating:</span>
              <span class="data-value editable" data-field="rating" id="rating">—</span>
            </div>
            <div class="data-item">
              <span class="data-label">Loss Ratio:</span>
              <span class="data-value editable" data-field="lossRatio" id="lossRatio">—</span>
            </div>
          </div>
        </div>
      </div>

      <!-- Risk Characteristics -->
      <div class="card">
        <div class="card-header">
          <h3 class="card-title">Risk Characteristics</h3>
        </div>
        <div class="card-body">
          <div class="data-grid">
            <div class="data-item">
              <span class="data-label">Construction:</span>
              <span class="data-value editable" data-field="construction" id="construction">—</span>
            </div>
            <div class="data-item">
              <span class="data-label">Occupancy:</span>
              <span class="data-value editable" data-field="occupancy" id="occupancy">—</span>
            </div>
            <div class="data-item">
              <span class="data-label">Sprinklered:</span>
              <span class="data-value editable" data-field="sprinklered" id="sprinklered">—</span>
            </div>
            <div class="data-item">
              <span class="data-label">Territory:</span>
              <span class="data-value editable" data-field="territory" id="territory">—</span>
            </div>
            <div class="data-item">
              <span class="data-label">Class:</span>
              <span class="data-value editable" data-field="class" id="class">—</span>
            </div>
            <div class="data-item">
              <span class="data-label">UW:</span>
              <span class="data-value editable" data-field="uw" id="uw">—</span>
            </div>
          </div>
        </div>
      </div>

      <!-- Pending Referrals -->
      <div class="card" id="referralsCard">
        <div class="card-header">
          <h3 class="card-title">Pending Referrals</h3>
          <button class="btn small primary" onclick="openReferralModal()">+ Add Referral</button>
        </div>
        <div class="card-body" id="referralsList">
          <div class="muted" style="text-align:center;padding:20px">No pending referrals</div>
        </div>
      </div>
    </div>

    <!-- Right Column -->
    <div>
      <!-- SOV (Statement of Values) -->
      <div class="card">
        <div class="card-header">
          <h3 class="card-title">Statement of Values</h3>
          <button class="btn small primary" onclick="addSOVRow()">+ Add Location</button>
        </div>
        <div class="card-body">
          <table class="sov-table" id="sovTable">
            <thead>
              <tr>
                <th>#</th>
                <th>Address</th>
                <th>TIV</th>
                <th>Flood Zone</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody id="sovBody">
              <tr>
                <td colspan="5" class="muted" style="text-align:center;padding:20px">No locations added</td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>

      <!-- Loss Runs -->
      <div class="card">
        <div class="card-header">
          <h3 class="card-title">Loss History</h3>
          <button class="btn small primary" onclick="addLossRow()">+ Add Loss</button>
        </div>
        <div class="card-body">
          <table class="loss-table" id="lossTable">
            <thead>
              <tr>
                <th>Date</th>
                <th>Type</th>
                <th>Amount</th>
                <th>Status</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody id="lossBody">
              <tr>
                <td colspan="5" class="muted" style="text-align:center;padding:20px">No losses recorded</td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>

      <!-- Documents -->
      <div class="card">
        <div class="card-header">
          <h3 class="card-title">Documents</h3>
          <button class="btn small primary" onclick="addDocument()">+ Upload</button>
        </div>
        <div class="card-body" id="documentsList">
          <div class="muted" style="text-align:center;padding:20px">No documents uploaded</div>
        </div>
      </div>
    </div>
  </div>
</main>

<!-- Referral Modal -->
<div id="referralModal" class="hidden" style="position:fixed;inset:0;background:rgba(0,0,0,0.5);display:flex;align-items:center;justify-content:center;z-index:1000">
  <div style="background:#fff;border-radius:12px;padding:20px;width:400px;max-width:90vw">
    <h3 style="margin:0 0 16px 0">Add Referral</h3>
    <div style="display:grid;gap:12px">
      <div>
        <label style="display:block;font-size:12px;font-weight:600;margin-bottom:4px">Refer to:</label>
        <select id="referTo" style="width:100%;padding:8px;border:1px solid var(--border);border-radius:6px">
          <option>Marin Nikolla (UW)</option>
          <option>Alex Morgan (UW)</option>
          <option>Priya Rao (UW)</option>
          <option>Ben Turner (UW)</option>
          <option>Jordan Lee (UA)</option>
        </select>
      </div>
      <div>
        <label style="display:block;font-size:12px;font-weight:600;margin-bottom:4px">Reason:</label>
        <select id="referReason" style="width:100%;padding:8px;border:1px solid var(--border);border-radius:6px">
          <option>Technical Review</option>
          <option>Pricing Review</option>
          <option>Coverage Review</option>
          <option>Peer Review</option>
          <option>Management Approval</option>
        </select>
      </div>
      <div>
        <label style="display:block;font-size:12px;font-weight:600;margin-bottom:4px">Comments:</label>
        <textarea id="referComments" rows="3" style="width:100%;padding:8px;border:1px solid var(--border);border-radius:6px;resize:vertical"></textarea>
      </div>
      <div style="display:flex;gap:8px;justify-content:flex-end;margin-top:8px">
        <button class="btn" onclick="closeReferralModal()">Cancel</button>
        <button class="btn primary" onclick="saveReferral()">Send Referral</button>
      </div>
    </div>
  </div>
</div>

<script>
// Global data
let currentRisk = null;
let pendingChanges = new Map();

// Sample data
const sampleRisk = {
  id: 'a1',
  insured: 'Orion AeroSystems',
  broker: 'Crestline Broking',
  lob: 'Property',
  product: 'Aviation PAR',
  premium: '$980,000',
  eff: '2025-11-01',
  exp: '2026-11-01',
  channel: 'Broker',
  stage: 'Quoted',
  priority: 'High',
  limits: '$50M',
  deductible: '$50K',
  retention: '$250K',
  exposure: '$200M',
  rating: 'A',
  lossRatio: '0.92',
  construction: 'Steel Frame',
  occupancy: 'Manufacturing',
  sprinklered: 'Yes',
  territory: 'Southwest',
  class: 'Aerospace',
  uw: 'Mike Rodriguez',
  sov: [],
  losses: [],
  referrals: [],
  documents: []
};

// Initialize
document.addEventListener('DOMContentLoaded', function() {
  loadRisk();
  setupInlineEditing();
  lucide.createIcons();
});

function loadRisk() {
  // Get risk ID from URL
  const urlParams = new URLSearchParams(window.location.search);
  const riskId = urlParams.get('id') || 'a1';
  
  // Load risk data (in real app, this would be from API)
  currentRisk = { ...sampleRisk };
  currentRisk.id = riskId;
  
  renderRisk();
}

function renderRisk() {
  if (!currentRisk) return;
  
  // Update header
  document.getElementById('riskName').textContent = currentRisk.insured;
  document.getElementById('riskStage').textContent = currentRisk.stage;
  document.getElementById('riskPriority').textContent = currentRisk.priority;
  
  // Update all data fields
  Object.keys(currentRisk).forEach(key => {
    const element = document.getElementById(key);
    if (element) {
      element.textContent = currentRisk[key] || '—';
    }
  });
  
  // Render SOV
  renderSOV();
  
  // Render losses
  renderLosses();
  
  // Render referrals
  renderReferrals();
  
  // Render documents
  renderDocuments();
}

function setupInlineEditing() {
  document.querySelectorAll('.editable').forEach(element => {
    element.addEventListener('click', function() {
      if (this.classList.contains('editing')) return;
      
      const field = this.dataset.field;
      const currentValue = this.textContent;
      
      this.innerHTML = `<input type="text" value="${currentValue}" style="width:100%;border:none;background:transparent;font-size:inherit;font-weight:inherit" onblur="saveEdit(this, '${field}')" onkeypress="if(event.key==='Enter') this.blur()">`;
      this.classList.add('editing');
      this.querySelector('input').focus();
    });
  });
}

function saveEdit(input, field) {
  const newValue = input.value;
  const element = input.parentElement;
  
  // Update the display
  element.textContent = newValue;
  element.classList.remove('editing');
  
  // Track changes
  if (currentRisk[field] !== newValue) {
    pendingChanges.set(field, newValue);
    currentRisk[field] = newValue;
  }
}

function saveAllChanges() {
  if (pendingChanges.size === 0) {
    alert('No changes to save');
    return;
  }
  
  // In real app, send to server
  console.log('Saving changes:', Object.fromEntries(pendingChanges));
  pendingChanges.clear();
  alert('Changes saved successfully');
}

// SOV Functions
function renderSOV() {
  const tbody = document.getElementById('sovBody');
  if (!currentRisk.sov || currentRisk.sov.length === 0) {
    tbody.innerHTML = '<tr><td colspan="5" class="muted" style="text-align:center;padding:20px">No locations added</td></tr>';
    return;
  }
  
  tbody.innerHTML = currentRisk.sov.map((location, index) => `
    <tr>
      <td>${index + 1}</td>
      <td><input type="text" value="${location.address}" onchange="updateSOV(${index}, 'address', this.value)" style="width:100%;border:none;background:transparent;font-size:11px"></td>
      <td><input type="text" value="${location.tiv}" onchange="updateSOV(${index}, 'tiv', this.value)" style="width:100%;border:none;background:transparent;font-size:11px"></td>
      <td><input type="text" value="${location.floodZone}" onchange="updateSOV(${index}, 'floodZone', this.value)" style="width:100%;border:none;background:transparent;font-size:11px"></td>
      <td><button class="btn small" onclick="deleteSOVRow(${index})">Delete</button></td>
    </tr>
  `).join('');
}

function addSOVRow() {
  if (!currentRisk.sov) currentRisk.sov = [];
  currentRisk.sov.push({
    address: '',
    tiv: '',
    floodZone: ''
  });
  renderSOV();
}

function updateSOV(index, field, value) {
  if (currentRisk.sov && currentRisk.sov[index]) {
    currentRisk.sov[index][field] = value;
  }
}

function deleteSOVRow(index) {
  if (confirm('Delete this location?')) {
    currentRisk.sov.splice(index, 1);
    renderSOV();
  }
}

// Loss Functions
function renderLosses() {
  const tbody = document.getElementById('lossBody');
  if (!currentRisk.losses || currentRisk.losses.length === 0) {
    tbody.innerHTML = '<tr><td colspan="5" class="muted" style="text-align:center;padding:20px">No losses recorded</td></tr>';
    return;
  }
  
  tbody.innerHTML = currentRisk.losses.map((loss, index) => `
    <tr>
      <td><input type="date" value="${loss.date}" onchange="updateLoss(${index}, 'date', this.value)" style="width:100%;border:none;background:transparent;font-size:11px"></td>
      <td><input type="text" value="${loss.type}" onchange="updateLoss(${index}, 'type', this.value)" style="width:100%;border:none;background:transparent;font-size:11px"></td>
      <td><input type="text" value="${loss.amount}" onchange="updateLoss(${index}, 'amount', this.value)" style="width:100%;border:none;background:transparent;font-size:11px"></td>
      <td><input type="text" value="${loss.status}" onchange="updateLoss(${index}, 'status', this.value)" style="width:100%;border:none;background:transparent;font-size:11px"></td>
      <td><button class="btn small" onclick="deleteLossRow(${index})">Delete</button></td>
    </tr>
  `).join('');
}

function addLossRow() {
  if (!currentRisk.losses) currentRisk.losses = [];
  currentRisk.losses.push({
    date: new Date().toISOString().split('T')[0],
    type: '',
    amount: '',
    status: 'Open'
  });
  renderLosses();
}

function updateLoss(index, field, value) {
  if (currentRisk.losses && currentRisk.losses[index]) {
    currentRisk.losses[index][field] = value;
  }
}

function deleteLossRow(index) {
  if (confirm('Delete this loss record?')) {
    currentRisk.losses.splice(index, 1);
    renderLosses();
  }
}

// Referral Functions
function renderReferrals() {
  const container = document.getElementById('referralsList');
  if (!currentRisk.referrals || currentRisk.referrals.length === 0) {
    container.innerHTML = '<div class="muted" style="text-align:center;padding:20px">No pending referrals</div>';
    return;
  }
  
  container.innerHTML = currentRisk.referrals.map((referral, index) => `
    <div class="referral-item">
      <div style="display:flex;justify-content:space-between;align-items:center">
        <div>
          <span class="referral-status ${referral.status}">${referral.status}</span>
          <strong>${referral.referTo}</strong> - ${referral.reason}
        </div>
        <button class="btn small" onclick="deleteReferral(${index})">×</button>
      </div>
      <div style="margin-top:4px;font-size:10px;color:var(--muted)">${referral.comments}</div>
    </div>
  `).join('');
}

function openReferralModal() {
  document.getElementById('referralModal').classList.remove('hidden');
}

function closeReferralModal() {
  document.getElementById('referralModal').classList.add('hidden');
}

function saveReferral() {
  const referTo = document.getElementById('referTo').value;
  const reason = document.getElementById('referReason').value;
  const comments = document.getElementById('referComments').value;
  
  if (!referTo || !reason) {
    alert('Please fill in required fields');
    return;
  }
  
  if (!currentRisk.referrals) currentRisk.referrals = [];
  currentRisk.referrals.push({
    referTo,
    reason,
    comments,
    status: 'pending',
    date: new Date().toISOString()
  });
  
  renderReferrals();
  closeReferralModal();
  
  // Clear form
  document.getElementById('referTo').value = '';
  document.getElementById('referReason').value = '';
  document.getElementById('referComments').value = '';
}

function deleteReferral(index) {
  if (confirm('Delete this referral?')) {
    currentRisk.referrals.splice(index, 1);
    renderReferrals();
  }
}

// Document Functions
function renderDocuments() {
  const container = document.getElementById('documentsList');
  if (!currentRisk.documents || currentRisk.documents.length === 0) {
    container.innerHTML = '<div class="muted" style="text-align:center;padding:20px">No documents uploaded</div>';
    return;
  }
  
  container.innerHTML = currentRisk.documents.map((doc, index) => `
    <div style="display:flex;justify-content:space-between;align-items:center;padding:6px 0;border-bottom:1px solid #f0f0f0">
      <div style="font-size:11px">
        <strong>${doc.name}</strong> <span class="muted">(${doc.type})</span>
      </div>
      <button class="btn small" onclick="deleteDocument(${index})">×</button>
    </div>
  `).join('');
}

function addDocument() {
  const input = document.createElement('input');
  input.type = 'file';
  input.multiple = true;
  input.onchange = function(e) {
    Array.from(e.target.files).forEach(file => {
      if (!currentRisk.documents) currentRisk.documents = [];
      currentRisk.documents.push({
        name: file.name,
        type: file.type,
        size: file.size,
        date: new Date().toISOString()
      });
    });
    renderDocuments();
  };
  input.click();
}

function deleteDocument(index) {
  if (confirm('Delete this document?')) {
    currentRisk.documents.splice(index, 1);
    renderDocuments();
  }
}
</script>
</body>
</html>
