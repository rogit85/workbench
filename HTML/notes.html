<!DOCTYPE html>
<html lang="en">
<head>
  <title>Underwriting Notes</title>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">
  <script src="https://unpkg.com/lucide@0.456.0/dist/umd/lucide.js"></script>
  <style>
    :root{--brand:#6F1111;--brand-2:#7A1414;--border:#E6E9EE;--bg:#F6F7F9;--text:#2A2F33;--muted:#6B757E}
    *{box-sizing:border-box} body{margin:0;font-family:Inter,system-ui;background:var(--bg);color:var(--text)}
    .appbar{position:sticky;top:0;z-index:50;background:linear-gradient(180deg,var(--brand),var(--brand-2));color:#fff;padding:12px 16px;display:flex;justify-content:space-between;align-items:center}
    .wrap{max-width:1600px;margin:0 auto;padding:16px}
    .board{display:grid;grid-template-columns:360px 1fr;gap:16px}
    .card{background:#fff;border:1px solid var(--border);border-radius:16px;box-shadow:0 10px 30px rgba(17,20,24,.06),0 2px 8px rgba(17,20,24,.04)}
    .hd{padding:12px 14px;border-bottom:1px solid var(--border);display:flex;justify-content:space-between;align-items:center}
    .bd{padding:12px 14px}
    .btn{display:inline-flex;align-items:center;gap:8px;padding:8px 12px;border:1px solid var(--border);border-radius:10px;background:#fff;cursor:pointer;font-weight:700}
    .btn.primary{background:#fff;color:var(--brand);border-color:#fff}
    .pill{display:inline-flex;align-items:center;gap:6px;border:1px solid var(--border);border-radius:999px;padding:4px 10px;background:#fff}
    .search{display:flex;gap:8px}
    .input{flex:1;padding:10px;border:1px solid var(--border);border-radius:10px}
    .list{display:grid;gap:10px}
    .noteItem{border:1px solid var(--border);border-radius:12px;padding:10px;cursor:pointer}
    .noteItem:hover{box-shadow:0 6px 16px rgba(17,20,24,.06)}
    .muted{color:var(--muted)}
    .tags{display:flex;gap:6px;flex-wrap:wrap}
    .viewer{min-height:500px}
    .assign{display:flex;gap:8px;align-items:center}
    .assign .pill{background:#FEF2F2;border-color:#FEE2E2}
  </style>
</head>
<body>
  <header class="appbar">
    <div style="display:flex;align-items:center;gap:10px"><strong>Underwriter Notes</strong><span id="riskName" style="opacity:.9"></span></div>
    <button class="btn" onclick="window.close()"><i data-lucide="x"></i> Close</button>
  </header>

  <main class="wrap">
    <div class="board">
      <!-- Left: list -->
      <section class="card">
        <div class="hd">
          <button class="btn" onclick="newNote()"><i data-lucide="plus"></i> New note</button>
          <button class="btn" onclick="saveCurrent()"><i data-lucide="save"></i> Save</button>
        </div>
        <div class="bd">
          <div class="search">
            <input id="q" class="input" placeholder="Search notes, tags… (Enter)" onkeydown="if(event.key==='Enter') filter()"/>
            <button class="btn" onclick="filter()"><i data-lucide="search"></i> Search</button>
          </div>
          <div style="margin-top:10px">
            <label class="pill"><input id="showMine" type="checkbox" checked> My notes</label>
          </div>
          <div id="list" class="list" style="margin-top:10px"></div>
        </div>
      </section>

      <!-- Right: viewer -->
      <section class="card viewer">
        <div class="hd">
          <div class="assign">
            <span class="pill"><i data-lucide="user"></i> Assigned to <strong>Marin Nikolla</strong></span>
            <span class="muted">This note needs to be assigned to self to enable editing</span>
          </div>
          <div class="tags" id="vTags"></div>
        </div>
        <div class="bd">
          <div class="tags" style="margin-bottom:8px" id="vTagEdit"></div>
          <input id="vTitle" class="input" placeholder="Note title"/>
          <div style="margin-top:10px"><input id="vFile" type="file" multiple/></div>
          <textarea id="vBody" class="input" style="height:280px;margin-top:10px" placeholder="Write your note…"></textarea>
          <div class="muted" id="vMeta" style="margin-top:8px"></div>
        </div>
      </section>
    </div>
  </main>

<script>
lucide.createIcons();
const $=s=>document.querySelector(s);
function qs(n){const p=new URLSearchParams(location.search);return p.get(n)||''}
const RID=qs('id')||'a8';
document.getElementById('riskName').textContent='• Risk '+RID;

/* Storage */
function k(){return 'notes_'+RID}
function load(){ try{return JSON.parse(localStorage.getItem(k())||'[]')}catch{return []}}
function save(list){ localStorage.setItem(k(), JSON.stringify(list)); render() }

/* State */
let CUR=null;

/* Render list */
function render(filterList){
  const data = filterList || load();
  const box=$('#list');
  if(!data.length){ box.innerHTML='<div class="muted">No notes yet.</div>'; return; }
  box.innerHTML=data.sort((a,b)=>b.ts-a.ts).map(n=>`
    <div class="noteItem" onclick="openNote('${n.id}')">
      <div class="muted" style="font-size:12px">${timeAgo(n.ts)}</div>
      <div class="pill" style="margin:6px 0">General note</div>
      <div style="font-weight:800">${n.title}</div>
      <div class="muted" style="font-size:13px;overflow:hidden;text-overflow:ellipsis;display:-webkit-box;-webkit-line-clamp:3;-webkit-box-orient:vertical">${n.text}</div>
      <div class="muted" style="font-size:12px;margin-top:6px">Created by ${n.user||'—'}</div>
    </div>
  `).join('');
  lucide.createIcons();
}
function timeAgo(ts){ const d=Math.floor((Date.now()-ts)/86400000); if(d>0) return d+' days ago'; const h=Math.floor((Date.now()-ts)/3600000); if(h>0) return h+' hours ago'; const m=Math.floor((Date.now()-ts)/60000); return (m||1)+' mins ago'; }

/* Open into viewer */
function openNote(id){
  const n=load().find(x=>x.id===id); if(!n) return;
  CUR=n;
  $('#vTitle').value=n.title||''; $('#vBody').value=n.text||''; $('#vMeta').textContent='Date created: '+new Date(n.ts).toLocaleString()+(n.version?` (Version ${n.version})`:'');
  $('#vTags').innerHTML=(n.tags||[]).map(t=>`<span class="pill">${t}</span>`).join('');
  $('#vTagEdit').innerHTML=(n.tags||[]).map((t,i)=>`<span class="pill">${t} <a href="#" onclick="removeTag(${i});return false;">×</a></span>`).join('')+` <button class="btn" onclick="addTag()">+ Tag</button>`;
}
function addTag(){ const t=prompt('New tag'); if(!t||!CUR) return; CUR.tags=(CUR.tags||[]).concat([t]); saveCurrent(true) }
function removeTag(i){ if(!CUR) return; CUR.tags.splice(i,1); saveCurrent(true) }

/* New note */
function newNote(){
  const list=load();
  const n={id:'n'+Date.now(),title:'New note',text:'',tags:[],files:[],user:'Marin Nikolla',ts:Date.now(),version:1};
  list.unshift(n); save(list); openNote(n.id);
}

/* Save current */
function saveCurrent(silent){
  if(!CUR) return;
  CUR.title=$('#vTitle').value.trim(); CUR.text=$('#vBody').value.trim();
  const files=[...($('#vFile').files||[])].map(f=>f.name); if(files.length) CUR.files=(CUR.files||[]).concat(files);
  CUR.version=(CUR.version||1)+1;
  const list=load().map(x=>x.id===CUR.id?CUR:x); save(list);
  if(!silent) alert('Saved');
}

/* Search */
function filter(){
  const q=($('#q').value||'').toLowerCase(); const mine=$('#showMine').checked;
  const data=load().filter(n=>{
    const okQ=!q || (n.title+n.text+(n.tags||[]).join(' ')).toLowerCase().includes(q);
    const okMine=!mine || (n.user==='Marin Nikolla');
    return okQ && okMine;
  });
  render(data);
}

/* Seed if empty */
(function seed(){
  const data=load(); if(data.length) { render(); return; }
  const now=Date.now();
  const demo=[
    {id:'n1',title:'General note for underwriting risk',text:'Lorem ipsum dolor sit amet consectetur. Turpis id dui donec eros ultricies pretium nisi lectus massa...',tags:['General note'],files:['screenshot.png'],user:'Marin Nikolla',ts:now-4*3600000,version:2},
    {id:'n2',title:'Interesting information',text:'Short research snippet...',tags:['Underwriting research'],user:'Marin Nikolla',ts:now-24*3600000,version:1},
    {id:'n3',title:'Broker information for rating',text:'Broker contact and approach...',tags:['Broker contact'],user:'Marin Nikolla',ts:now-26*3600000,version:1}
  ];
  save(demo);
})();
</script>
</body>
</html>
